What needs to change (Trae + ModelMix) to support your “Deliberation Chatroom” mode You’ve got three distinct problems tangled together: Identity display is wrong (analyst/creative + long model names) Routing UX is wrong (@ mention shows long IDs; persona title is the goal) Privacy semantics are broken (your “private” message is effectively broadcast) Below is an implementation-grade fix list you can hand to Trae. 1) Fix identity once: separate “persona identity” from “model identity” Required data model change Every message must carry two identities: personaId (what the UI shows) modelId/provider (metadata only; never rendered) type AgentIdentity = { agentId: string // internal stable id personaId: string // short label: "Planner" personaTitle?: string // optional: "Architect Planner" modelId: string // "qwen2.5-32b" provider: string // "lmstudio" } type ChatMessage = { id: string deliberationId?: string sessionId: string role: "user" | "agent" | "system" visibility: "broadcast" | "private" toAgentId?: string // only for private fromAgentId?: string // for agent messages personaId?: string // denormalized for rendering speed content: string createdAt: number meta?: { modelId?: string provider?: string round?: number } } Rendering rule (hard) UI label comes from personaId only. Never show role=analyst/creative anywhere. Never show modelId/provider anywhere in the transcript. If Trae currently maps “assistant persona” → analyst/creative, you override that by injecting and enforcing personaId at the orchestrator level and in the renderer. 2) Stop using @mentions for routing (mentions are display only) Why this matters Mentions should not be the routing mechanism, because: UI shows long names It conflates “addressing” with “display identity” It breaks when you rename personas Required behavior Routing should be an explicit property: { "visibility": "private", "toAgentId": "agent_critic", "content": "Check assumption #2 only." } UI changes Replace @ mentions with a “Send to…” picker Displays persona titles only (Planner/Critic/Implementer) Internally selects agentId @ typing (optional) can remain as a shortcut, but must insert personaId only, never the long model name. Even then: do not route from the text token. 3) Implement real private messages (don’t leak to excluded agents) Right now your system is doing: private → stored once → broadcast to all bots That’s a fundamental bug. Fix: enforce privacy at dispatch time When orchestrator prepares each agent’s input: Broadcast messages: included for all included agents Private messages: included only for the target agent Pseudo: function buildContextForAgent(agentId: string, messages: ChatMessage[]) { return messages.filter(m => m.visibility === "broadcast" || (m.visibility === "private" && m.toAgentId === agentId) ) } Also enforce “excluded agents receive nothing” If an agent is excluded from a deliberation, they must not receive: broadcast messages private messages round summaries task updates This is an orchestrator responsibility, not a UI checkbox. 4) Deliberation chatroom log + main session handoff You want A chatroom transcript that shows the “round discussion” Only the final consensus returns to the main ModelMix session Implementation rule Store deliberation transcript separately and link it: deliberation_messages table (or collection) main_session_messages table (your normal MM chat) On completion: Append one message to main session: role: "system" (or assistant) content: "Consensus: …" meta: { deliberationId, consensusConfidence } And optionally a link button: “View deliberation transcript”. 5) Enforce short back-and-forth replies (UI + server) Don’t rely on models behaving. Enforce it in two places: Server: max tokens Per agent call: max_tokens ~ 80–120 Stop sequences if needed UI: display constraints If a model returns too long: Truncate display and store full in meta Or reject and auto-regenerate with a stricter “too long” retry prompt Trae ticket list (copy/paste ready) Transcript identity fix Render personaId only Never render analyst/creative Never render modelId/provider Routing decoupled from @mentions Add toAgentId routing field UI “Send to…” persona picker Mentions optional, display-only Private message isolation Private message delivered only to target agent Must not appear in other agents’ context Must not be included in round summaries/history for others Excluded agent isolation Excluded agents receive zero messages (broadcast/private/system) for that deliberation Deliberation mode UI Chatroom transcript view Start/Pause/Resume/Stop Round indicator On completion: inject consensus into main MM session only If you want, I can update the canvas doc to add a dedicated “Trae Work Items / Acceptance Criteria” section with test cases like: “Send private message to Critic; verify Planner never sees it in context” “Rename persona; verify transcript still displays persona title, routing still works” “Excluded agent never receives SSE events for that deliberation”